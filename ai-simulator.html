<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Analysis Simulator - CognitivePath</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 25px 35px;
            border-radius: 15px;
            margin-bottom: 25px;
            box-shadow: 0 5px 25px rgba(0,0,0,0.15);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            color: #2c3e50;
            font-size: 2.2em;
        }

        .header-subtitle {
            color: #7f8c8d;
            font-size: 1em;
            margin-top: 5px;
        }

        .badge {
            display: inline-block;
            padding: 6px 14px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 20px;
            font-size: 0.75em;
            margin-left: 10px;
            font-weight: 600;
        }

        .header-actions {
            display: flex;
            gap: 12px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.95em;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-success {
            background: #27ae60;
            color: white;
        }

        .btn-home {
            background: #34495e;
            color: white;
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 0.85em;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .full-width {
            grid-column: 1 / -1;
        }

        .card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 3px 15px rgba(0,0,0,0.1);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #ecf0f1;
        }

        .card-title {
            font-size: 1.4em;
            color: #2c3e50;
            font-weight: 600;
        }

        .card-actions {
            display: flex;
            gap: 10px;
        }

        .upload-area {
            border: 3px dashed #667eea;
            border-radius: 15px;
            padding: 50px;
            text-align: center;
            background: #f8f9fa;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .upload-area:hover {
            background: #e9ecef;
            border-color: #764ba2;
        }

        .upload-icon {
            font-size: 4em;
            margin-bottom: 15px;
        }

        .upload-text {
            color: #2c3e50;
            font-size: 1.1em;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .upload-subtext {
            color: #7f8c8d;
            font-size: 0.9em;
        }

        .scenarios-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .scenario-btn {
            padding: 20px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border: 2px solid transparent;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .scenario-btn:hover {
            border-color: #667eea;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .scenario-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .scenario-title {
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 1em;
        }

        .scenario-subtitle {
            font-size: 0.8em;
            opacity: 0.8;
        }

        .transcript-viewer {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            max-height: 500px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            line-height: 1.8;
        }

        .transcript-line {
            margin-bottom: 12px;
            padding: 8px;
            border-radius: 5px;
            transition: background 0.3s;
        }

        .transcript-line:hover {
            background: #e9ecef;
        }

        .timestamp {
            color: #7f8c8d;
            font-weight: 600;
            margin-right: 10px;
        }

        .speaker {
            color: #667eea;
            font-weight: 600;
            margin-right: 10px;
        }

        .text {
            color: #2c3e50;
        }

        .highlight-pause {
            background: #fff3cd;
            padding: 2px 5px;
            border-radius: 3px;
        }

        .highlight-repeat {
            background: #f8d7da;
            padding: 2px 5px;
            border-radius: 3px;
        }

        .highlight-hesitation {
            background: #d1ecf1;
            padding: 2px 5px;
            border-radius: 3px;
        }

        .signal-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .signal-item {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border-left: 5px solid;
            transition: transform 0.3s;
        }

        .signal-item:hover {
            transform: translateX(5px);
        }

        .signal-item.high {
            border-color: #e74c3c;
        }

        .signal-item.medium {
            border-color: #f39c12;
        }

        .signal-item.low {
            border-color: #3498db;
        }

        .signal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .signal-name {
            font-weight: 600;
            color: #2c3e50;
            font-size: 1.1em;
        }

        .confidence-badge {
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.85em;
            font-weight: 600;
            color: white;
        }

        .confidence-high {
            background: #e74c3c;
        }

        .confidence-medium {
            background: #f39c12;
        }

        .confidence-low {
            background: #3498db;
        }

        .signal-description {
            color: #7f8c8d;
            font-size: 0.9em;
            line-height: 1.6;
            margin-bottom: 10px;
        }

        .signal-evidence {
            background: white;
            padding: 12px;
            border-radius: 5px;
            font-size: 0.85em;
            color: #555;
        }

        .confidence-meter {
            margin-top: 20px;
        }

        .meter-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            color: #2c3e50;
            font-weight: 600;
        }

        .meter-bar {
            height: 30px;
            background: #ecf0f1;
            border-radius: 15px;
            overflow: hidden;
            position: relative;
        }

        .meter-fill {
            height: 100%;
            background: linear-gradient(90deg, #27ae60, #f39c12, #e74c3c);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 15px;
            color: white;
            font-weight: 600;
            transition: width 1s ease;
        }

        .comparison-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .comparison-panel {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
        }

        .panel-header {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.1em;
            text-align: center;
            padding: 10px;
            background: white;
            border-radius: 8px;
        }

        .metric-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #e0e0e0;
        }

        .metric-label {
            color: #7f8c8d;
            font-weight: 600;
        }

        .metric-value {
            color: #2c3e50;
            font-weight: bold;
        }

        .metric-value.improved {
            color: #27ae60;
        }

        .metric-value.declined {
            color: #e74c3c;
        }

        .ai-explanation {
            background: #e8f5e9;
            padding: 20px;
            border-radius: 10px;
            border-left: 5px solid #27ae60;
            margin-top: 20px;
        }

        .explanation-title {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .explanation-text {
            color: #555;
            line-height: 1.7;
            font-size: 0.95em;
        }

        .processing-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .processing-overlay.active {
            display: flex;
        }

        .processing-content {
            background: white;
            padding: 40px;
            border-radius: 15px;
            text-align: center;
            max-width: 500px;
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 5px solid #ecf0f1;
            border-top-color: #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .processing-text {
            color: #2c3e50;
            font-size: 1.1em;
            margin-bottom: 10px;
        }

        .processing-step {
            color: #7f8c8d;
            font-size: 0.9em;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .card {
            animation: fadeIn 0.5s ease-out;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div>
                <h1>AI Analysis Simulator <span class="badge">DEMO</span></h1>
                <div class="header-subtitle">Interactive Speech Analysis & Cognitive Signal Detection</div>
            </div>
            <div class="header-actions">
                <button class="btn btn-success" onclick="showHelp()">How It Works</button>
                <button class="btn btn-home" onclick="location.href='index.html'">Home</button>
            </div>
        </div>

        <div class="main-grid">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Upload Audio/Video</h2>
                </div>
                <div class="upload-area" onclick="document.getElementById('fileInput').click()">
                    <div class="upload-icon">ðŸŽ¤</div>
                    <div class="upload-text">Click to Upload or Drag & Drop</div>
                    <div class="upload-subtext">Supported: MP3, WAV, MP4, AVI (Max 100MB)</div>
                    <input type="file" id="fileInput" style="display: none;" accept="audio/*,video/*" onchange="processFile()">
                </div>
                <div style="margin-top: 20px; text-align: center; color: #7f8c8d;">
                    <strong>OR</strong> select a pre-loaded scenario below
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Pre-loaded Patient Scenarios</h2>
                </div>
                <div class="scenarios-grid">
                    <button class="scenario-btn" onclick="loadScenario(1)">
                        <div class="scenario-title">Scenario 1</div>
                        <div class="scenario-subtitle">High Risk<br>Early Detection</div>
                    </button>
                    <button class="scenario-btn" onclick="loadScenario(2)">
                        <div class="scenario-title">Scenario 2</div>
                        <div class="scenario-subtitle">Moderate Risk<br>Word Finding</div>
                    </button>
                    <button class="scenario-btn" onclick="loadScenario(3)">
                        <div class="scenario-title">Scenario 3</div>
                        <div class="scenario-subtitle">Low Risk<br>Healthy Baseline</div>
                    </button>
                    <button class="scenario-btn" onclick="loadScenario(4)">
                        <div class="scenario-title">Scenario 4</div>
                        <div class="scenario-subtitle">Intervention<br>Post-Treatment</div>
                    </button>
                    <button class="scenario-btn" onclick="loadScenario(5)">
                        <div class="scenario-title">Scenario 5</div>
                        <div class="scenario-subtitle">Declining<br>Needs Escalation</div>
                    </button>
                </div>
                <div style="margin-top: 20px; padding: 15px; background: #fff3cd; border-radius: 8px; font-size: 0.9em; color: #856404;">
                    <strong>Note:</strong> All scenarios use synthetic data for demonstration purposes. Real patient data is HIPAA-protected.
                </div>
            </div>
        </div>

        <div class="main-grid">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Real-Time Transcript</h2>
                    <div class="card-actions">
                        <button class="btn btn-small btn-primary" onclick="exportTranscript()">Export</button>
                    </div>
                </div>
                <div class="transcript-viewer" id="transcriptViewer">
                    <div style="text-align: center; color: #7f8c8d; padding: 50px;">
                        Select a scenario or upload a file to begin analysis
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Detected Cognitive Signals</h2>
                </div>
                <div class="signal-list" id="signalList">
                    <div style="text-align: center; color: #7f8c8d; padding: 50px;">
                        Signals will appear here after analysis
                    </div>
                </div>
            </div>
        </div>

        <div class="main-grid">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Confidence Scoring</h2>
                </div>
                <div class="confidence-meter">
                    <div class="meter-label">
                        <span>Overall Risk Assessment</span>
                        <span id="riskScore">--</span>
                    </div>
                    <div class="meter-bar">
                        <div class="meter-fill" id="meterFill" style="width: 0%">
                            <span id="meterText"></span>
                        </div>
                    </div>
                </div>
                <div class="ai-explanation" style="margin-top: 25px;">
                    <div class="explanation-title">AI Decision-Making Process</div>
                    <div class="explanation-text" id="aiExplanation">
                        The AI analyzes multiple speech patterns simultaneously, including pause duration, word retrieval speed, vocabulary diversity, and conversation coherence. Each detected signal is weighted based on clinical significance and combined to produce an overall risk assessment with confidence scoring.
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Before/After Comparison</h2>
                    <div class="card-actions">
                        <button class="btn btn-small btn-success" onclick="showComparison()">Load Comparison</button>
                    </div>
                </div>
                <div class="comparison-grid" id="comparisonGrid">
                    <div style="text-align: center; color: #7f8c8d; padding: 50px; grid-column: 1 / -1;">
                        Load a scenario with intervention history to view before/after comparison
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Processing Overlay -->
    <div class="processing-overlay" id="processingOverlay">
        <div class="processing-content">
            <div class="spinner"></div>
            <div class="processing-text">Analyzing Speech Patterns...</div>
            <div class="processing-step" id="processingStep">Converting audio to text...</div>
        </div>
    </div>

    <script>
        const scenarios = {
            1: {
                name: "High Risk - Early Detection",
                transcript: [
                    { time: "00:00", speaker: "Doctor", text: "Good morning, Mrs. Thompson. How have you been feeling?" },
                    { time: "00:03", speaker: "Patient", text: "Oh, I've been... <span class='highlight-pause'>[pause 2.1s]</span> you know, pretty good overall." },
                    { time: "00:08", speaker: "Doctor", text: "Have you noticed any changes in your memory or thinking?" },
                    { time: "00:11", speaker: "Patient", text: "Well, sometimes I can't... <span class='highlight-pause'>[pause 2.8s]</span> what's the word... <span class='highlight-hesitation'>um</span>... remember where I put things." },
                    { time: "00:18", speaker: "Doctor", text: "Can you tell me about your daily routine?" },
                    { time: "00:21", speaker: "Patient", text: "I wake up and then... <span class='highlight-pause'>[pause 2.3s]</span> well, I do my... <span class='highlight-repeat'>my morning... my morning routine</span>... breakfast and such." },
                    { time: "00:29", speaker: "Doctor", text: "What did you have for breakfast today?" },
                    { time: "00:31", speaker: "Patient", text: "Let me think... <span class='highlight-pause'>[pause 3.2s]</span> I had... <span class='highlight-hesitation'>uh</span>... cereal, I think? Or was it... <span class='highlight-pause'>[pause 2.5s]</span> toast?" }
                ],
                signals: [
                    {
                        name: "Prolonged Word Retrieval Pauses",
                        confidence: "High (92%)",
                        level: "high",
                        description: "Patient exhibits significantly longer pauses (avg 2.6s vs baseline 1.1s) when searching for common words. This pattern is consistent across multiple exchanges.",
                        evidence: "Detected 5 instances of pauses >2.0s during word retrieval tasks"
                    },
                    {
                        name: "Reduced Vocabulary Diversity",
                        confidence: "High (87%)",
                        level: "high",
                        description: "Analysis shows 23% reduction in unique word usage compared to age-matched normative data. Patient relies on simpler, more repetitive language structures.",
                        evidence: "Type-Token Ratio: 0.42 (expected: 0.55-0.65 for age group)"
                    },
                    {
                        name: "Topic Tracking Difficulty",
                        confidence: "Medium (78%)",
                        level: "medium",
                        description: "Mild difficulty maintaining conversation threads. Patient occasionally loses track of question context or provides tangential responses.",
                        evidence: "2 instances of topic drift in 8-minute conversation"
                    }
                ],
                risk: 73,
                riskText: "High Risk - Early Intervention Recommended"
            },
            2: {
                name: "Moderate Risk - Word Finding",
                transcript: [
                    { time: "00:00", speaker: "Doctor", text: "How are you managing your medications?" },
                    { time: "00:02", speaker: "Patient", text: "Oh, I take them... <span class='highlight-pause'>[pause 1.8s]</span> regularly. My daughter helps me with the... the... <span class='highlight-pause'>[pause 1.5s]</span> you know, the thing... the organizer." },
                    { time: "00:11", speaker: "Doctor", text: "The pill organizer?" },
                    { time: "00:12", speaker: "Patient", text: "Yes! That's it. The pill organizer." },
                    { time: "00:15", speaker: "Doctor", text: "Have you had any issues with appointments?" },
                    { time: "00:17", speaker: "Patient", text: "Sometimes I... <span class='highlight-pause'>[pause 1.6s]</span> forget what day they're on, but I have them written down." }
                ],
                signals: [
                    {
                        name: "Word-Finding Difficulties",
                        confidence: "High (85%)",
                        level: "medium",
                        description: "Patient shows difficulty retrieving specific nouns, often using circumlocution ('the thing', 'you know') instead of target words.",
                        evidence: "4 instances of word-finding difficulty in short conversation"
                    },
                    {
                        name: "Compensatory Strategies Present",
                        confidence: "Medium (74%)",
                        level: "low",
                        description: "Patient demonstrates use of compensatory strategies (written notes, family support), suggesting awareness of deficits.",
                        evidence: "Mentions external memory aids and support systems"
                    }
                ],
                risk: 52,
                riskText: "Moderate Risk - Monitor Closely"
            },
            3: {
                name: "Low Risk - Healthy Baseline",
                transcript: [
                    { time: "00:00", speaker: "Doctor", text: "How has your week been?" },
                    { time: "00:02", speaker: "Patient", text: "Excellent! I went to my grandson's soccer game on Saturday, and we won 3-2. Then Sunday I had brunch with my book club." },
                    { time: "00:09", speaker: "Doctor", text: "That sounds wonderful. What book are you reading?" },
                    { time: "00:11", speaker: "Patient", text: "We're reading 'The Midnight Library' by Matt Haig. It's about parallel universes and life choices. Fascinating concept, really makes you think." },
                    { time: "00:19", speaker: "Doctor", text: "Are you keeping up with your exercise routine?" },
                    { time: "00:21", speaker: "Patient", text: "Absolutely. I walk 30 minutes every morning, do yoga twice a week, and I just started a tai chi class on Thursdays." }
                ],
                signals: [
                    {
                        name: "Strong Narrative Coherence",
                        confidence: "High (94%)",
                        level: "low",
                        description: "Patient demonstrates excellent memory for recent events with rich detail and clear temporal sequencing.",
                        evidence: "Detailed recollection of multiple events with specific information"
                    },
                    {
                        name: "High Vocabulary Diversity",
                        confidence: "High (91%)",
                        level: "low",
                        description: "Patient uses varied and sophisticated vocabulary appropriate for education level. No word-finding difficulties observed.",
                        evidence: "Type-Token Ratio: 0.68 (excellent for age group)"
                    }
                ],
                risk: 18,
                riskText: "Low Risk - Healthy Cognitive Function"
            },
            4: {
                name: "Post-Intervention Progress",
                transcript: [
                    { time: "00:00", speaker: "Doctor", text: "How are the cognitive exercises going?" },
                    { time: "00:02", speaker: "Patient", text: "Much better! I do them every morning after breakfast. My favorite is the memory game with the cards." },
                    { time: "00:08", speaker: "Doctor", text: "Have you noticed any improvements?" },
                    { time: "00:10", speaker: "Patient", text: "Yes, definitely. I'm remembering names better, and I don't lose my keys as much. Last week I even remembered my neighbor's grandson's name without having to ask." },
                    { time: "00:20", speaker: "Doctor", text: "That's excellent progress. How about word recall?" },
                    { time: "00:22", speaker: "Patient", text: "It's improved. I still pause sometimes, but not as long as before. The exercises are really helping." }
                ],
                signals: [
                    {
                        name: "Reduced Pause Duration",
                        confidence: "High (89%)",
                        level: "low",
                        description: "Significant improvement in word retrieval speed. Average pause duration decreased from 2.6s to 1.3s.",
                        evidence: "43% reduction in pause duration compared to baseline"
                    },
                    {
                        name: "Improved Memory Encoding",
                        confidence: "Medium (76%)",
                        level: "low",
                        description: "Patient reports and demonstrates better memory for recent events and names, suggesting improved encoding.",
                        evidence: "Successful recall of specific details from recent events"
                    }
                ],
                risk: 34,
                riskText: "Improving - Continue Intervention"
            },
            5: {
                name: "Declining - Needs Escalation",
                transcript: [
                    { time: "00:00", speaker: "Doctor", text: "Hello Mr. Garcia, how have you been?" },
                    { time: "00:02", speaker: "Patient", text: "I... <span class='highlight-pause'>[pause 3.5s]</span> I'm... doing... <span class='highlight-pause'>[pause 2.8s]</span> okay, I guess." },
                    { time: "00:09", speaker: "Doctor", text: "Are you still doing your daily exercises?" },
                    { time: "00:11", speaker: "Patient", text: "The... <span class='highlight-pause'>[pause 4.1s]</span> exercises? <span class='highlight-pause'>[pause 2.3s]</span> I... I think so? My wife... <span class='highlight-pause'>[pause 3.2s]</span> she helps me." },
                    { time: "00:20", speaker: "Doctor", text: "What did you do yesterday?" },
                    { time: "00:22", speaker: "Patient", text: "Yesterday... <span class='highlight-pause'>[pause 5.2s]</span> I... I don't... <span class='highlight-repeat'>I don't remember... I don't remember</span>." }
                ],
                signals: [
                    {
                        name: "Severely Prolonged Pauses",
                        confidence: "High (96%)",
                        level: "high",
                        description: "Critical increase in pause duration (avg 3.6s, up from 2.6s at baseline). Patient shows significant struggle with word retrieval.",
                        evidence: "Multiple pauses >3.0s, maximum 5.2s"
                    },
                    {
                        name: "Memory Encoding Failure",
                        confidence: "High (93%)",
                        level: "high",
                        description: "Patient unable to recall recent events (yesterday's activities). This represents a significant decline from baseline.",
                        evidence: "Complete inability to recall events from previous day"
                    },
                    {
                        name: "Repetitive Language",
                        confidence: "High (88%)",
                        level: "high",
                        description: "Patient repeats phrases verbatim, suggesting difficulty generating new responses or maintaining conversation flow.",
                        evidence: "Exact phrase repetition observed multiple times"
                    }
                ],
                risk: 89,
                riskText: "Critical - Immediate Escalation Required"
            }
        };

        let currentScenario = null;

        function loadScenario(num) {
            // Remove active class from all buttons
            document.querySelectorAll('.scenario-btn').forEach(btn => btn.classList.remove('active'));

            // Add active class to clicked button
            event.target.closest('.scenario-btn').classList.add('active');

            // Show processing overlay
            document.getElementById('processingOverlay').classList.add('active');

            // Simulate processing steps
            const steps = [
                "Converting audio to text...",
                "Analyzing speech patterns...",
                "Detecting cognitive signals...",
                "Calculating confidence scores...",
                "Generating report..."
            ];

            let stepIndex = 0;
            const stepInterval = setInterval(() => {
                document.getElementById('processingStep').textContent = steps[stepIndex];
                stepIndex++;
                if (stepIndex >= steps.length) {
                    clearInterval(stepInterval);
                    setTimeout(() => {
                        document.getElementById('processingOverlay').classList.remove('active');
                        displayScenario(num);
                    }, 500);
                }
            }, 800);

            currentScenario = num;
        }

        function displayScenario(num) {
            const scenario = scenarios[num];

            // Display transcript
            const transcriptViewer = document.getElementById('transcriptViewer');
            transcriptViewer.innerHTML = scenario.transcript.map(line => `
                <div class="transcript-line">
                    <span class="timestamp">${line.time}</span>
                    <span class="speaker">${line.speaker}:</span>
                    <span class="text">${line.text}</span>
                </div>
            `).join('');

            // Display signals
            const signalList = document.getElementById('signalList');
            signalList.innerHTML = scenario.signals.map(signal => `
                <div class="signal-item ${signal.level}">
                    <div class="signal-header">
                        <div class="signal-name">${signal.name}</div>
                        <div class="confidence-badge confidence-${signal.level}">
                            ${signal.confidence}
                        </div>
                    </div>
                    <div class="signal-description">${signal.description}</div>
                    <div class="signal-evidence"><strong>Evidence:</strong> ${signal.evidence}</div>
                </div>
            `).join('');

            // Update confidence meter
            document.getElementById('riskScore').textContent = scenario.risk + '%';
            const meterFill = document.getElementById('meterFill');
            setTimeout(() => {
                meterFill.style.width = scenario.risk + '%';
                document.getElementById('meterText').textContent = scenario.risk + '%';
            }, 100);

            // Update AI explanation
            document.getElementById('aiExplanation').textContent =
                `Based on analysis of this ${scenario.name.toLowerCase()} case, the AI detected ${scenario.signals.length} significant cognitive signals. ` +
                `The overall risk score of ${scenario.risk}% is calculated by combining weighted confidence scores from each signal, ` +
                `with higher weights given to signals with stronger clinical evidence and research backing. ` +
                `${scenario.riskText}.`;
        }

        function processFile() {
            const file = document.getElementById('fileInput').files[0];
            if (file) {
                alert('File Upload Demo:\n\n' +
                      `Selected file: ${file.name}\n` +
                      `Size: ${(file.size / 1024 / 1024).toFixed(2)} MB\n\n` +
                      'In production, this would:\n' +
                      '1. Upload the file securely to our servers\n' +
                      '2. Convert speech to text using AI\n' +
                      '3. Analyze for cognitive signals\n' +
                      '4. Generate detailed report\n\n' +
                      'For this demo, please use the pre-loaded scenarios.');
            }
        }

        function exportTranscript() {
            if (!currentScenario) {
                alert('Please load a scenario first.');
                return;
            }
            alert('Exporting transcript...\n\n' +
                  'Format: Text file with timestamps\n' +
                  'Includes: Full transcript and detected signals\n' +
                  'File: transcript_export.txt\n\n' +
                  'Export complete!');
        }

        function showComparison() {
            if (currentScenario !== 4) {
                alert('Before/After comparison is only available for Scenario 4 (Post-Intervention).\n\n' +
                      'Please load Scenario 4 to view intervention progress.');
                return;
            }

            const comparisonGrid = document.getElementById('comparisonGrid');
            comparisonGrid.innerHTML = `
                <div class="comparison-panel">
                    <div class="panel-header">Before Intervention (Baseline)</div>
                    <div class="metric-row">
                        <span class="metric-label">Average Pause Duration:</span>
                        <span class="metric-value declined">2.6 seconds</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Word Retrieval Score:</span>
                        <span class="metric-value declined">62/100</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Vocabulary Diversity:</span>
                        <span class="metric-value declined">0.48 TTR</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Overall Risk Score:</span>
                        <span class="metric-value declined">73%</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Cognitive Exercises:</span>
                        <span class="metric-value">0% completion</span>
                    </div>
                </div>
                <div class="comparison-panel">
                    <div class="panel-header">After Intervention (3 Months)</div>
                    <div class="metric-row">
                        <span class="metric-label">Average Pause Duration:</span>
                        <span class="metric-value improved">1.3 seconds â†“43%</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Word Retrieval Score:</span>
                        <span class="metric-value improved">81/100 â†‘31%</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Vocabulary Diversity:</span>
                        <span class="metric-value improved">0.59 TTR â†‘23%</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Overall Risk Score:</span>
                        <span class="metric-value improved">34% â†“53%</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Cognitive Exercises:</span>
                        <span class="metric-value improved">87% completion</span>
                    </div>
                </div>
            `;
        }

        function showHelp() {
            alert('How the AI Analysis Simulator Works:\n\n' +
                  '1. SPEECH PROCESSING\n' +
                  '   â€¢ Converts audio/video to text using speech recognition\n' +
                  '   â€¢ Identifies pauses, hesitations, and speech patterns\n' +
                  '   â€¢ Timestamps every utterance for analysis\n\n' +
                  '2. SIGNAL DETECTION\n' +
                  '   â€¢ Analyzes multiple cognitive markers simultaneously\n' +
                  '   â€¢ Compares patterns to age-matched normative data\n' +
                  '   â€¢ Identifies deviations from expected baselines\n\n' +
                  '3. CONFIDENCE SCORING\n' +
                  '   â€¢ Each signal receives a confidence percentage\n' +
                  '   â€¢ Based on clinical research and validation studies\n' +
                  '   â€¢ Combined into overall risk assessment\n\n' +
                  '4. CLINICAL INTERPRETATION\n' +
                  '   â€¢ Results contextualized for healthcare providers\n' +
                  '   â€¢ Actionable recommendations generated\n' +
                  '   â€¢ Integration with EHR systems\n\n' +
                  'Try the 5 pre-loaded scenarios to see different risk levels!');
        }

        console.log('AI Analysis Simulator Loaded');
        console.log('5 pre-loaded patient scenarios available');
        console.log('Supported formats: Audio and video files');
    </script>
</body>
</html>
